# Dev Standard（開発の約束）v0.1

この文書は、Starley / Cotomo のプロダクト開発チームが「価値を届ける」ための、日々の開発の約束です。

- 文体は「〜しよう / 〜としよう」で統一しよう
- 迷ったら、この文書の原則に戻って判断しよう

---

## 1. 目的
- チームの判断軸（優先順位・重要度）をそろえよう
- 人が増えても、同じ品質・同じスピードでDeliveryできるようにしよう

## 2. 対象
- プロダクト開発に関わる全員（正社員・業務委託をふくむ）

---

## 3. 大事にする原則

### 3.1 Delivery：価値を「届ける」ことを大切にしよう
- ゴールは「作ること」ではなく「ユーザに価値が届くこと」にしよう
- 大きい変更は小さく分けて、リリース可能な単位で進めよう

### 3.2 Ops：価値を「守る」ことも同じくらい大切にしよう
- コア価値の体験がこわれたら（たとえ一時的でも）障害として扱おう
- 障害対応の約束は Ops Standard に従おう

---

## 4. ブランチ運用（現時点）
- `develop` を開発のベースにしよう（PRは基本ここへ）
- `main` はProduction反映のブランチとして扱おう
- `main` にマージするとProductionにデプロイされる前提で動こう

> 補足：Productionは全環境が置き換わるまで約20分かかる。

---

## 5. PRの約束

### 5.1 PRで書こう（短くてOK）
PRには、最低限これを書こう。
- 何がよくなる？（ユーザ価値 / 価値を守る）
- リスクはある？（あれば書こう）
- 本番で何を見て「成功」と言う？（成功条件 / ガードレール）

### 5.2 レビューで見よう
- 失敗したときにユーザ影響が大きくならない設計になっているか
- ロールバック（戻す）が現実的にできるか
- 本番で観測できるか（ログ / Sentry / Monitoring で確認できるか）

---

## 6. リリースの約束（Production）

### 6.1 「リリースしたら終わり」にしないで、確認までやろう
- ProductionのReleaseを実行した人は、リリース後の確認までやろう
- 「デプロイ完了」ではなく、「狙いどおりに動いている」ことを確認して終わりにしよう

### 6.2 Done（完了）の考え方
リリースは、次を満たしたら完了にしよう。
- Productionの置換が完了している（目安：20分後）
- 成功条件（Success Criteria）が満たされている
- ガードレール（Guardrail）が悪化していない
- それを GCP Monitoring と Sentry で確認できている

### 6.3 確認するタイミング（確認ウィンドウ）
Release実行時刻を `T0` として、基本はこうしよう。
- **T+25分**：置換完了後の初回確認
- **T+45分**：安定の確認（成功条件・ガードレールをもう一度）

「エラーを0にする」など品質回復系は、成功条件が安定するまで見続けよう。

### 6.4 成功条件とガードレールは先に決めよう
- `main` に入れる前に、「何を見て成功と言うか」を1行で決めよう

例：
- Success：対象エラーが0になる
- Guardrail：5xxが増えない / レイテンシが悪化しない

### 6.5 だめなら戻そう
- 失敗のサインが出たら、まずユーザ影響を止めよう
- ためらわずに戻そう（revert、一部戻し、設定戻しなど）

### 6.6 Slack投稿テンプレ（おすすめ）
**リリース直後**
```text
[Release] prod T0=13:00 実行=@me
Success: 対象エラー=0
Guardrail: 5xx増加なし / latency悪化なし
Check: 13:25 / 13:45 に確認して完了宣言
```

**完了宣言（確認後）**
```text
[Release] verified 実行=@me
Sentry: 対象エラー0（13:25〜13:45で確認）
Monitoring: 5xx/latency悪化なし
```

---

## 7. 関連ドキュメント
- Ops Standard（障害対応 / P1 / オンコール / 見る場所）: `docs/develop/ops.md`
