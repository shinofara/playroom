Flutter PJでの機能要件と非機能要件を整理。以下は一旦まず書き起こした物

ほかにも追加する

- [ ] 起動画面

- [ ] ログイン画面

- [ ] ユーザー情報入力画面

- [ ] 好み選択画面

- [ ] Discover画面

- [ ] Discover会話開始画面

- [ ] ショップ

- [ ] お知らせ一覧

- [ ] お知らせ詳細

- [ ] カード画面（お気に入り）

- [ ] 会話済みCotomo一覧（すべて）

- [ ] 会話画面

- [ ] 生成画像プレビュー

- [ ] Cotomo詳細画面

- [ ] バッジ

- [ ] 思い出

- [ ] クリエイター

- [ ] Cotomo設定画面

- [ ] 声変更画面

- [ ] Cotomo作成

- [ ] Cotomo設計書入力

- [ ] 声選択

- [ ] アイコンの種類選択

- [ ] AIアイコン作成

- [ ] AIアイコン作成完了後

- [ ] AIアイコン編集

- [ ] マイページ

- [ ] あなたのプロフィール

- [ ] レコメンド設定

- [ ] Adjust（SDK setupのみ）

- [ ] Amplitude

- [ ] Sentry

- [ ] Firebase Analytics

- [ ] 通知

- [ ] universal link

- [ ] test flight

- [ ] OTA配布

- [ ] Firebase Remote Config (が、できるような仕組み）

アプリの起動画面から始まり、起動後のログインフローは以下の通りです。
1. iOSの場合は Apple と Google、Android の場合は Google でログイン
2. その他に「登録せずに利用する」ボタンも用意されています

アプリの主な利用形態は、ログインして使うパターンと、ログインせずに使うパターンの2種類です。

ユーザー情報入力では「名前」「性別」「年齢（生年月日）」を入力します。その後の遷移は以下の通りです。
1. 「Cotomoを作る」か「Cotomoを探す」のどちらのルートに行くかを選択する画面が表示されます。
2. 「作る」を選択した場合は Cotomo 作成画面が開きます。
3. 「Cotomoを選ぶ」ボタンを選択すると、Discover 画面が開きます。

会話機能については以下の構成になっています。
1. Discover 画面で Cotomo を選択すると「会話開始画面」に移動します。
2. 会話開始画面の状態は2種類あります。
   (a) ロールプレイパスを使用する場合：ロールプレイの箇所に「パス利用」ボタンが表示されます。
   (b) ロールプレイパス使用済み、または使用中の場合：何も表示されません。
3. 会話開始画面に表示されるコンテンツは「ロールプレイボタン」「日常会話ボタン」「音声で会話ボタン」です。

各画面の機能詳細は以下の通りです。

1. Discover 画面
   テキスト検索エリアがあり、入力したテキストで Cotomo を検索・表示できます。

2. 共通ヘッダー（Discover、Home、お気に入り、すべての Cotomo 画面で共通）
   (a) Daily ボタン：Daily モーダルが立ち上がり、カレンダーの確認やキャンディ獲得が可能です。
   (b) ショップボタン：ショップ画面が開きます。Cotomo の商品やキャンディ、非公開枠などが購入できます。
   (c) お知らせボタン：タップすると WebView が開き、お知らせの URL が表示されます。

3. お気に入り画面 / キャラクター画面
   「お気に入り画面」と「すべての Cotomo」画面は構成が同じで、フィルターで表示を切り替える仕組みです。
   (a) お気に入りフィルター：最大3体の Cotomo が表示されます。
   (b) すべての Cotomo：リスト形式ですべてが表示されます。

4. Cotomo を作る画面
   (a) 公開・非公開の選択
   (b) Cotomo の名前入力
   (c) その他の詳細情報の入力

改めて整理すると、画面下のタブには以下の4つのルートページが存在します。
1. Discover（起動時に表示されるメイン画面）
2. キャラクター画面（お気に入りと一覧を表示）
3. Cotomo を作る
4. プロフィール

ここまでが画面構成の概要です。次はお気に入り一覧で Cotomo に対してできることについて説明します。

お気に入り一覧や詳細ページにおける Cotomo の機能と、会話画面の仕様について説明します。

1. キャラクター画面（お気に入り・一覧）でできること
   (a) キャラクターのアイコンをタップすると、その Cotomo の詳細ページに移動します。
   (b) 詳細ページでは、これまでの通算会話時間や獲得したバッジを確認できます。
   (c) 詳細ページからの遷移先には、ギャラリーページと思い出ページがあります。
   (d) 自分が作成した Cotomo の場合は、編集画面に遷移するボタンが表示され、お別れ（削除）などの操作も可能です。
   (e) 一覧画面からも同様に、お気に入りへの追加やお別れ、詳細ページへの移動ができます。

2. 会話の開始と再開
   (a) 一覧とお気に入りのどちらにも「おしゃべりをする」ボタンがあり、これを押すと会話画面へ移動します。
   (b) 会話は、前回のセッションで利用したモード（音声またはテキスト）を引き継いで再開されます。

3. 会話画面の技術仕様
   (a) 基本的に WebSocket で接続されており、音声データや入力テキストをリアルタイムに送信しています。
   (b) 音声画面では「EchoBack」という仕組みがあります。サーバーサイドから送られてくる EchoBack を受け取った際、transcribeId が同じであれば、同じ発話バルーンを上書きする形でユーザー側の表示内容を更新します。
   (c) コマンド制御：
       ・SyncStart：波打つアニメーションを開始
       ・SyncEnd：アニメーションを停止
       ・reply finished：音声の場合は再生完了時、テキストの場合は表示完了時に送信
   (d) 割り込み処理：Cotomo が話している最中にユーザーが話し始めた場合、Cotomo 側の発話を停止させる制御が必要です。

4. エコーキャンセル
   iPhone 14 Pro 以降などの端末で、スピーカーモードかつ大音量で利用する場合、自分の音声を再度拾ってループしたり、ハウリング（ワー音化）したりするのを防ぐために実装しています。

5. 会話画面内の付随機能
   (a) 画像生成・送信
       ・クイックイメージ作成：Cotomo の直近の発言をもとにサーバー側で画像を生成します。
       ・カスタムイメージ作成：プラスボタンから選択。ユーザーが任意の内容を入力することで、文脈に依存しない自由な画像生成を依頼できます。
   (b) おしゃべりアイデア
       キャンディを消費して利用します。テキスト入力を補助するために、サーバー側から推奨される話題やフレーズが届く仕組みです。
   (c) その他
       ギャラリーへの移動が可能です。

ここからは機能要件についてです。

1. アプリの引き継ぎとログイン状態の維持
   同じバンドルIDでアプリを引き継ぐ際（例：iOSでUnity版からFlutter版へ移行する場合など）、ログイン状態が維持されるようにしてください。
   (a) 理由：GoogleやApple IDで連携しているユーザーは問題ありませんが、アカウント登録せずに利用しているユーザーが、移行時にアカウントを失ってしまうのを防ぐためです。

2. 会話画面のWebSocket再接続
   サーバー側のデプロイを行うとWebSocketのコネクションが切断されるため、切断時には自動で再接続を試行してください。
   (a) 再接続の仕様：指数バックオフを適用し、最大5回程度までリトライしてください。
   (b) 失敗時の挙動：リトライが完全に失敗した場合は、会話お気に入り画面に戻るようにしてください。

3. ショップ機能
   iOSおよびAndroidにおいて、それぞれのApp Store、Google Playストアから「Cotomoコイン」を購入できるようにしてください。

4. 外部SDKおよびツール連携
   (a) Amplitude：Unity版で取得しているイベントと同様のデータが取得できること。
   (b) Firebase Remote Config：全ての機能は不要ですが、少なくとも一つは何かが正常に動作する実績を作っておいてください。
   (c) Adjust：
       - Adjust SDKを導入し、ADID（広告識別子）が取得できていること。
       - インストールイベント等のデータをAdjustへ送信できること。
       - ユーザー作成時に、そのユーザーがどのADIDに紐付いているかを把握することが重要です。そのため、Adjust SDKで取得したデータをCotomoのユーザー作成APIに含めて送信してください。

5. ログインおよび端末移行時の対応
   ログイン時にFirebase IDと現在ログイン中のIDに不一致が発生した場合は、ユーザーにログアウトを促してください。
   (a) 誘導方法：トラブル防止のため強制ログアウトは行わず、「ログアウトします」というダイアログを表示してください。
   (b) 案内内容：端末移行の場合は、以前の端末でアカウント連携を完了させてから、新しい端末で再度ログイン処理を行うよう案内してください。

6. 通知とUI表示
   サーバーからWebSocket経由で通知（Notification）を送っています。通知を受け取った際は、「おはよう」といったメッセージやAI Web等を表示させる処理を実装してください。

7. UIの操作感
   リストのスクロール操作（ズルズルする操作感）などは、SlackやLINEといった一般的なアプリケーションと同様の、自然で快適な操作感を目指してください。

----


ここからは非機能要件についてです。

1. アプリの引き継ぎとログイン状態の維持
   同じバンドルIDでアプリを引き継ぐ際（例：iOSでUnity版からFlutter版へ移行する場合など）、ログイン状態が維持されるようにしてください。
   (a) 理由：GoogleやApple IDで連携しているユーザーは問題ありませんが、アカウント登録せずに利用しているユーザーが、移行時にアカウントを失ってしまうのを防ぐためです。

2. 会話画面のWebSocket再接続
   サーバー側のデプロイを行うとWebSocketのコネクションが切断されるため、切断時には自動で再接続を試行してください。
   (a) 再接続の仕様：指数バックオフを適用し、最大5回程度までリトライしてください。
   (b) 失敗時の挙動：リトライが完全に失敗した場合は、会話お気に入り画面に戻るようにしてください。

3. ショップ機能
   iOSおよびAndroidにおいて、それぞれのApp Store、Google Playストアから「Cotomoコイン」を購入できるようにしてください。

4. 外部SDKおよびツール連携
   (a) Amplitude：Unity版で取得しているイベントと同様のデータが取得できること。
   (b) Firebase Remote Config：全ての機能は不要ですが、少なくとも一つは何かが正常に動作する実績を作っておいてください。
   (c) Adjust：
       - Adjust SDKを導入し、ADID（広告識別子）が取得できていること。
       - インストールイベント等のデータをAdjustへ送信できること。
       - ユーザー作成時に、そのユーザーがどのADIDに紐付いているかを把握することが重要です。そのため、Adjust SDKで取得したデータをCotomoのユーザー作成APIに含めて送信してください。

5. ログインおよび端末移行時の対応
   ログイン時にFirebase IDと現在ログイン中のIDに不一致が発生した場合は、ユーザーにログアウトを促してください。
   (a) 誘導方法：トラブル防止のため強制ログアウトは行わず、「ログアウトします」というダイアログを表示してください。
   (b) 案内内容：端末移行の場合は、以前の端末でアカウント連携を完了させてから、新しい端末で再度ログイン処理を行うよう案内してください。

6. 通知とUI表示
   サーバーからWebSocket経由で通知（Notification）を送っています。通知を受け取った際は、「おはよう」といったメッセージやAI Web等を表示させる処理を実装してください。

7. UIの操作感
   リストのスクロール操作（ズルズルする操作感）などは、SlackやLINEといった一般的なアプリケーションと同様の、自然で快適な操作感を目指してください。